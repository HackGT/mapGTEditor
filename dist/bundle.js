!function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";s.r(e);class i{constructor(t,e){this.x=t,this.y=e}get x(){return this._x}get y(){return this._y}set x(t){this._x=t}set y(t){this._y=t}equals(t){return this.x==t.x&&this.y==t.y}toString(){return`(${this.x}, ${this.y})`}static add(t,e){return new i(t.x+e.x,t.y+e.y)}static subtract(t,e){return new i(t.x-e.x,t.y-e.y)}static divide(t,e){return new i(t.x/e,t.y/e)}static mod(t){return Math.sqrt(t.x*t.x+t.y*t.y)}static midPoint(t,e){return i.divide(i.add(t,e),2)}}class n{constructor(t,e,s,i,n="circle",r={}){this.domElement=document.createElementNS(o,n);for(let t in r)this.domElement.setAttributeNS(null,t,r[t]);this.canvas=t,this.location=e,this.domElement.setAttributeNS(null,"cx",this.location.x),this.domElement.setAttributeNS(null,"cy",this.location.y),this.canvas.nodesContainer.appendChild(this.domElement),this.shapes=[],this.connections=[],this.eventListeners=[];for(let t=0;t<i.length;t++)this.eventListeners.push({type:i[t].type,event:i[t].event,callBack:i[t].callBack,invoke:i[t].invoke});for(let t=0;t<this.eventListeners.length;t++)this.eventListeners[t].callBack=this.eventListeners[t].callBack.bind(this);this.id=s}show(){this.domElement.setAttributeNS(null,"visibility","visible")}hide(){this.domElement.setAttributeNS(null,"visibility","hidden")}connectTo(t){this.connections.push(t),t.connections.push(this)}updateLocation(t){this.domElement.setAttributeNS(null,"cx",t.x),this.domElement.setAttributeNS(null,"cy",t.y)}editEventListenerInvokeStatus(t,e,s){const i=this.eventListeners;for(let n=0;n<i.length;n++)i[n].event===t&&(i[n].invoke=e,e?s.domElement.addEventListener(i[n].event,i[n].callBack):s.domElement.removeEventListener(i[n].event,i[n].callBack))}}const o="http://www.w3.org/2000/svg";class r{constructor(t,e,s="canvas",i="canvas-container"){this.domElement=document.createElementNS(o,"svg"),this.domElement.setAttributeNS(null,"width",t),this.domElement.setAttributeNS(null,"height",e),this.domElement.setAttributeNS(null,"id","canvas"),this.containerDomElement=document.getElementById(i),this.containerDomElement?this.containerDomElement.appendChild(this.domElement):console.err("Could not find a container to put the canvas svg in"),this.nodesContainer=document.createElementNS(o,"g"),this.nodesContainer.setAttributeNS(null,"id","nodes"),this.domElement.appendChild(this.nodesContainer),this.shapes=[],this.currentShape=null,this.canvasId=s,this.currentTool=null,this.currentEventListeners=[],this.clicked=!0,this.masterState=[],this.currentState=[]}getCursorPosition(t=window.event){let e=t.clientX-this.containerDomElement.offsetLeft,s=t.clientY-this.containerDomElement.offsetTop;return new i(e,s)}getNewId(){return this.shapes.length}add(t){this.domElement.insertBefore(t.domGroup,this.domElement.firstChild),this.clicked=!1,this.currentShape=t,this.masterState.push(t),this.currentState.push(t),this.shapes.push(t)}setCurrentTool(t){this.currentTool=t,this._removeEventListeners(),this._setEventListeners(t.eventListeners)}createNode(t,e=this.currentShape){const s=new n(this,t,this._getNewNodeID(e),e.nodeEventListeners,"circle",{fill:"cyan",stroke:"black","stroke-width":"3px",r:"5px"});return s.shapes.push(e),e.nodes.push(s),s}updateNodeId(t,e){t.id+=e.id+"/"+e.nodes.length}_setEventListeners(t){this.currentEventListeners?console.warn("Setting new event listeners without removing old listeners"):(this.currentEventListeners=t,t.forEach(t=>{t.invoke&&this.domElement.addEventListener(t.event,t.callBack)}))}_removeEventListeners(){this.currentEventListeners.forEach(t=>{this.domElement.removeEventListener(t.event,t.callBack)}),this.currentEventListeners=null}_getNewNodeID(t){return t.id+"/"+t.nodes.length}}class a{constructor(t,e,s){this.name=t,this.domElement=document.createElement("button"),this.domElement.innerHTML=this.name;const i=document.querySelector(".tools");i?i.appendChild(this.domElement):console.err("No container div (with class `tool`) found"),this.canvas=e,this.eventListeners=s;for(let t=0;t<this.eventListeners.length;t++)this.eventListeners[t].callBack=this.eventListeners[t].callBack.bind(this)}onClickTool(){this.canvas.setCurrentTool(this)}editEventListenerInvokeStatus(t,e){const s=this.eventListeners;for(let i=0;i<s.length;i++)s[i].event===t&&(s[i].invoke=e,e?this.canvas.domElement.addEventListener(s[i].event,s[i].callBack):(this.canvas.domElement.removeEventListener(s[i].event,s[i].callBack),this.canvas.clicked=!0))}}class h extends a{constructor(t){super("select",t,[]),this.domElement.addEventListener("click",this.onClickTool.bind(this))}onClickTool(){this.canvas.setCurrentTool(this),this.canvas.shapes.forEach(t=>{if(0===t.eventListeners.length)console.warn(`${t} has not populated its eventListeners attribute. Read comments in Shape.js on how to do that`);else{const e=t.eventListeners.filter(t=>"select"===t.type);for(let s of e)t.domElement.addEventListener(s.event,s.callBack),this.canvas.currentEventListeners.push({event:s.event,callBack:s.callBack})}})}}class l{constructor(t,e,s={},i="path",n=!1){this.canvas=t,this.name=e,this.domElement=document.createElementNS(o,i),this.domGroup=document.createElementNS(o,"g"),this.domGroup.appendChild(this.domElement),this.attributes=s,this.id=this.canvas.getNewId(),this.nodes=[],this.clickedCursorPositions=[this.canvas.getCursorPosition()],this.initialCursorPosition=this.clickedCursorPositions[0],this.eventListeners=[],this.nodeEventListeners=[],this.selected=!1,n&&this.canvas.domElement.appendChild(this.domGroup)}get attributes(){return this._attributes}set attributes(t){for(let e in t)this.domElement.setAttributeNS(null,e,t[e])}changeAttributes(t){this.attributes=t}addNodes(){console.error("addNodes() is shape specific and needs to be implemented")}showNodes(){for(let t of this.nodes)t.show()}hideNodes(){for(let t of this.nodes)t.hide()}render(){console.error("render() method needs to be implemented for this shape")}registerClick(){console.error("updateClickedCursorPositions() needs to be implemented for this shape")}onSelect(){this.selected?(this.hideNodes(),this.toggleNodeEventListeners(!1)):(this.showNodes(),this.toggleNodeEventListeners(!0)),this.selected=!this.selected}toggleNodeEventListeners(t){if(t)for(let t of this.nodes)t.editEventListenerInvokeStatus("mousedown",!0,t);else for(let t of this.nodes)t.editEventListenerInvokeStatus("mousedown",!1,t)}}class c extends l{constructor(t,e={stroke:"black",fill:"none","stroke-width":"5px"}){super(t,"rect",e),this.clickedCursorPositions=[this.initialCursorPosition,this.initialCursorPosition],this.width=this.clickedCursorPositions[1].x-this.initialCursorPosition.x,this.height=this.clickedCursorPositions[1].y-this.initialCursorPosition.y,this.dParts=[{type:"M",values:[this.initialCursorPosition.x,this.initialCursorPosition.y],node:this.canvas.createNode(new Point(this.initialCursorPosition.x,this.initialCursorPosition.y),this)}],this.render()}render(){this.changeAttributes({d:this._getD()})}registerClick(t){this.clickedCursorPositions[1]=t,this.dParts=[{type:"M",values:[this.initialCursorPosition.x,this.initialCursorPosition.y],node:this.canvas.createNode(new Point(this.initialCursorPosition.x,this.initialCursorPosition.y),this)},{type:"L",values:[t.x,this.initialCursorPosition.y],node:this.canvas.createNode(new Point(this.initialCursorPosition.x,this.initialCursorPosition.y),this)},{type:"L",values:[t.x,t.y],node:this.canvas.createNode(new Point(this.initialCursorPosition.x,this.initialCursorPosition.y),this)},{type:"L",values:[this.initialCursorPosition.x,t.y],node:this.canvas.createNode(new Point(this.initialCursorPosition.x,this.initialCursorPosition.y),this)}],this.width=this.clickedCursorPositions[1].x-this.initialCursorPosition.x,this.height=this.clickedCursorPositions[1].y-this.initialCursorPosition.y,this.render()}updateNodes(){for(let t of this.dParts)t.node&&t.node.updateLocation(new Point(t.values[0],t.values[1]))}updateDParts(t,e){t>this.dParts.length?console.warn("Looks like you are doing some janky stuff with dParts. Please check your code!"):(this.dParts[t].values=e,this.render())}_getD(){const t=this.initialCursorPosition,e=[Point.add(t,new Point(this.width,0)),this.clickedCursorPositions[1],Point.add(t,new Point(0,this.height)),t];let s=`M ${t.x} ${t.y} `;return e.forEach(t=>{s+=`L ${t.x} ${t.y} `}),s}}function d(){this.editEventListenerInvokeStatus("mousemove",!0,this.canvas),this.editEventListenerInvokeStatus("mouseup",!0,this.canvas)}function u(){const t=this.id.split("/");for(let e=0;e<t.length-1;e++){const s=t[e],i=t[e+1],n=this.shapes.filter(t=>t.id==s)[0],o=this.canvas.getCursorPosition(event);n.updateDParts(i,[o.x,o.y])}}function v(){this.editEventListenerInvokeStatus("mousemove",!1,this.canvas),this.editEventListenerInvokeStatus("mouseup",!1,this.canvas)}class m extends l{constructor(t,e={stroke:"black",fill:"none","stroke-width":"5px"}){super(t,"polygon",e),this.eventListeners=[{event:"click",type:"select",callBack:this.onSelect.bind(this)}],this.nodeEventListeners=[{event:"mousedown",type:"node",callBack:d,invoke:!1},{event:"mousemove",type:"node",callBack:u,invoke:!1},{event:"mouseup",type:"node",callBack:v,invoke:!1}],this.dParts=[{type:"M",values:[this.initialCursorPosition.x,this.initialCursorPosition.y],node:this.canvas.createNode(new i(this.initialCursorPosition.x,this.initialCursorPosition.y),this)},{type:"L",values:[this.initialCursorPosition.x,this.initialCursorPosition.y],node:this.canvas.createNode(new i(this.initialCursorPosition.x,this.initialCursorPosition.y),this)}],this.render()}render(){this.changeAttributes({d:this._getD()}),this.updateNodes()}registerClick(t){this.dParts.push({type:"L",values:[t.x,t.y],node:this.canvas.createNode(new i(t.x,t.y),this)}),this.clickedCursorPositions.push(t)}updateNodes(){for(let t of this.dParts)t.node&&t.node.updateLocation(new i(t.values[0],t.values[1]))}updateDParts(t,e){t>this.dParts.length?console.warn("Looks like you are doing some janky stuff with dParts. Please check your code!"):(this.dParts[t].values=e,this.render())}completeShape(){this.dParts.push({type:"Z",values:[]}),this.hideNodes(),this.render()}updateLastCursorPosition(t){const e=this.dParts[this.dParts.length-1];e.values=[t.x,t.y],e.node.updateLocation(new i(t.x,t.y))}getLastClickPosition(){const t=this.dParts[this.dParts.length-2].values;return new i(t[0],t[1])}_getD(){let t="";for(let e of this.dParts){t+=`${e.type} `;for(let s of e.values)t+=`${s} `}return t}}function p(){const t=this.canvas.currentShape;this.canvas.clicked?(this.canvas.add(new c(this.canvas)),this.editEventListenerInvokeStatus("mousemove",!0)):(this.editEventListenerInvokeStatus("mousemove",!1),t.registerClick(this.canvas.getCursorPosition(event)))}function k(t){this.canvas.currentShape.registerClick(this.canvas.getCursorPosition(t))}function P(t){if(this.canvas.clicked)this.canvas.add(new m(this.canvas)),this.editEventListenerInvokeStatus("mousemove",!0);else{const e=this.canvas.currentShape,s=this.canvas.getCursorPosition(t),i=e.getLastClickPosition();s.equals(e.initialCursorPosition)||s.equals(i)?(e.nodes[e.nodes.length-1].domElement.remove(),e.nodes.pop(),e.dParts.pop(e.dParts.length-2),e.completeShape(),this.editEventListenerInvokeStatus("mousemove",!1)):e.registerClick(s)}}function E(t){const e=this.canvas.currentShape;e.updateLastCursorPosition(this.canvas.getCursorPosition(t)),e.render()}class f extends a{constructor(t){super("rectangle",t,[{event:"click",callBack:p,invoke:!0},{event:"mousemove",callBack:k,invoke:!1}]),this.domElement.addEventListener("click",this.onClickTool.bind(this))}}class y extends a{constructor(t){super("polygon",t,[{event:"click",callBack:P,invoke:!0},{event:"mousemove",callBack:E,invoke:!1}]),this.domElement.addEventListener("click",this.onClickTool.bind(this))}}window.onload=()=>{const t=new r(1e3,500);new h(t),new f(t),new y(t)}}]);